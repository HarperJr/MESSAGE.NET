@model Messanger.Data.Models.Consumer

<style>
    ul li {
        display: block;
        text-decoration: none;
        padding: 15px;
    }

        ul li:hover {
            background: #b6ff00;
        }
</style>

<div class="modal fade" id="consumersModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="consumersContainer" class="modal-body">
                
            </div>
        </div>
    </div>
</div>

<div style="
    width: 860px;
    height: 500px;
    position: absolute;
    margin: auto;
    top: 70px;
    left: 0;
    right: 0;
    flex-flow: row;">

    <div id="dialogs" class="mdc-card" style="
    flex-basis: 200px;
    flex: 2;">

        <div id="container" style="
    position:inherit;
    margin:16px;
    background:#808080">
            <ul>
                <li>
                    <div>
                        @Model.Name
                    </div>
                </li>
            </ul>
        </div>

        <div id="dialogsContainer" style="
    position:inherit;
    margin:16px;
    background:#0094ff">

        </div>

    </div>

    <div id="content" style="
    margin-left: 20px;
    flex: 5;
    flex-direction: column">

        <div class="mdc-card" style="
    flex: 6;">

            <div id="contentHeader" style="
    position:inherit;
    width:inherit;
    height:64px;">
                <div style="
    float:right;
    justify-content:center">

                    <div>
                        <form>
                            <input id="comsumersSearch" type="search" placeholder="Search others..." name="name"/>
                            <button type="button" onclick="onSearchButtonClicked()" class="btn">Search</button>
                        </form>
                    </div>

                </div>
            </div>

        </div>

        <div class="mdc-card" style="
    margin-top: 20px;
    flex: 1;">

            <div style="
                 margin: 16px">
                <form>
                    <input id="messageBox" type="text" style="position:relative" />
                    <button type="button" class="btn" name="sendMessage" onclick="onSendMessageClicked()">Send</button>
                </form>
            </div>

        </div>

    </div>

</div>

<script>
    var messanger = {
        identifier: "4b47286f-a4f6-41fd-aec3-cc547d135052",
        dialogsLoaded: 0,
        dialogsPortion: 10,
        messagesLoaded: 0,
        messagesPortion: 30,
        consumersLoaded: 0,
        consumersPortion: 30
    }

    $(function () {
        loadDialogsAsync(messanger.identifier, messanger.dialogsLoaded, messanger.dialogsPortion);
    });

    function loadDialogsAsync(uid, from, portion) {
        $.ajax({
            url: "@Url.Action("Dialogs", "Home")",
            method: "post",
            data: {
                uid: uid,
                offset: from,
                limit: portion
            },
            error: function () { },
            success: function (view) {
                $("#dialogsContainer").html(view);
            }
        });
    }

    function searchConsumersAsync(name, from, portion) {
         $.ajax({
            url: "@Url.Action("Consumers", "Home")",
            method: "post",
            data: {
                name: name,
                offset: from,
                limit: portion
            },
             success: function (view) {
                 $("#consumersContainer").html(view);
                 $("#consumersModal").modal('show')
             },
             error: function () {
                 alert("Unable to find others with tag " + name);
             }
        });
    }

    function sendMessageAsync(message) {
        $.ajax({

        });
    }

    function onSendMessageClicked() {
        alert("onSendMessageClicked");

    }

    function onDialogClicked(dialog) {
        alert("onDialogClicked " + dialog);

    }

    function onConsumerClicked(consumer) {
        alert("onConsumerClicked " + consumer);

    }

    function onSearchButtonClicked() {
        searchConsumersAsync($("#comsumersSearch").val(),
            messanger.consumersLoaded,
            messanger.consumersPortion);
    }

    function connect() {
        var socket = new WebSocket("ws://localhost/Messanger");
        socket.onclose = function (event) {

        }
    }

</script>


